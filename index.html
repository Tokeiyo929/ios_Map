<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆå…¬å¸æ±‚èŒåœ°å›¾</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: #e6e6e6;
        }
        #header {
            background-color: #16213e;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        h1 {
            margin: 0;
            color: #4cc9f0;
            font-size: 2.5rem;
        }
        .subtitle {
            color: #a9b7c6;
            margin-top: 10px;
            font-size: 1.1rem;
        }
        #map-container {
            height: calc(100vh - 140px);
            position: relative;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .company-popup {
            max-width: 400px;
        }
        .company-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .company-item {
            padding: 10px;
            border-bottom: 1px solid #2d3746;
            margin-bottom: 5px;
        }
        .company-item:last-child {
            border-bottom: none;
        }
        .company-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .company-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #4cc9f0;
        }
        .country-flag {
            margin-left: 10px;
            font-size: 1.2rem;
        }
        .company-details {
            color: #a9b7c6;
            font-size: 0.9rem;
        }
        .employee-count {
            margin-top: 5px;
            color: #72efdd;
        }
        .city-title {
            text-align: center;
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #72efdd;
            border-bottom: 1px solid #2d3746;
            padding-bottom: 5px;
        }
        .company-count {
            background-color: #4361ee;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: rgba(22, 33, 62, 0.9);
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            color: #e6e6e6;
        }
        .legend-title {
            margin-top: 0;
            margin-bottom: 10px;
            color: #4cc9f0;
            font-size: 1.1rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .legend-circle {
            border-radius: 50%;
            margin-right: 10px;
        }
        .legend-text {
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>æ¸¸æˆå…¬å¸æ±‚èŒåœ°å›¾</h1>
        <div class="subtitle">ç‚¹å‡»åŸå¸‚æŸ¥çœ‹è¯¥åœ°åŒºçš„æ¸¸æˆå…¬å¸ä¿¡æ¯</div>
    </div>
    <div id="map-container">
        <div id="map"></div>
        <div class="legend">
            <h3 class="legend-title">åŸå¸‚æ¸¸æˆå…¬å¸æ•°é‡</h3>
            <div class="legend-item">
                <div class="legend-circle" style="width: 10px; height: 10px; background-color: #4ade80;"></div>
                <div class="legend-text">1-5 å®¶å…¬å¸</div>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="width: 16px; height: 16px; background-color: #f59e0b;"></div>
                <div class="legend-text">6-15 å®¶å…¬å¸</div>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="width: 22px; height: 22px; background-color: #ef4444;"></div>
                <div class="legend-text">16+ å®¶å…¬å¸</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="gameCompaniesData.js"></script>
    <script>
        // åˆå§‹åŒ–åœ°å›¾
        const map = L.map('map').setView([30, 0], 2);

        // æ·»åŠ åœ°å›¾å›¾å±‚
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // æ ¹æ®å…¬å¸æ•°é‡è®¡ç®—æ ‡è®°å¤§å°
        function getMarkerSize(companyCount) {
            if (companyCount <= 5) return 10;
            if (companyCount <= 15) return 16;
            return 22;
        }

        // æ ¹æ®å…¬å¸æ•°é‡è®¡ç®—æ ‡è®°é¢œè‰²
        function getMarkerColor(companyCount) {
            if (companyCount <= 5) return '#4ade80';
            if (companyCount <= 15) return '#f59e0b';
            return '#ef4444';
        }

        // å¤„ç†åŸå¸‚æ•°æ®ï¼ŒæŒ‰åŸå¸‚åˆ†ç»„
        const cities = {};
        gameCompaniesData.forEach(company => {
            const cityKey = `${company.city}, ${company.country}`;
            if (!cities[cityKey]) {
                cities[cityKey] = {
                    name: company.city,
                    country: company.country,
                    lat: company.lat,
                    lng: company.lng,
                    companies: []
                };
            }
            cities[cityKey].companies.push(company);
        });

        // ä¸ºæ¯ä¸ªåŸå¸‚æ·»åŠ æ ‡è®°
        Object.values(cities).forEach(city => {
            const companyCount = city.companies.length;
            const markerSize = getMarkerSize(companyCount);
            const markerColor = getMarkerColor(companyCount);
            
            // åˆ›å»ºè‡ªå®šä¹‰æ ‡è®°
            const marker = L.circleMarker([city.lat, city.lng], {
                radius: markerSize,
                fillColor: markerColor,
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);

            // ä¸ºæ ‡è®°æ·»åŠ ç‚¹å‡»äº‹ä»¶
            marker.bindPopup(`
                <div class="company-popup">
                    <div class="city-title">
                        ${city.name}, ${city.country}
                        <span class="company-count">${companyCount}</span>
                    </div>
                    <div class="company-list">
                        ${city.companies.map(company => `
                            <div class="company-item">
                                <div class="company-header">
                                    <div class="company-name">${company.name}</div>
                                    <div class="country-flag">${getCountryFlag(company.country)}</div>
                                </div>
                                <div class="company-details">
                                    <div>${company.city}, ${company.country}</div>
                                    <div class="employee-count">å‘˜å·¥æ•°: ${formatEmployeeCount(company.employees)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `);
        });

        // è·å–å›½å®¶å¯¹åº”çš„å›½æ——emoji
        function getCountryFlag(country) {
            const flagMap = {
                'ä¸­å›½': 'ğŸ‡¨ğŸ‡³',
                'ç¾å›½': 'ğŸ‡ºğŸ‡¸',
                'æ—¥æœ¬': 'ğŸ‡¯ğŸ‡µ',
                'éŸ©å›½': 'ğŸ‡°ğŸ‡·',
                'åŠ æ‹¿å¤§': 'ğŸ‡¨ğŸ‡¦',
                'è‹±å›½': 'ğŸ‡¬ğŸ‡§',
                'æ³•å›½': 'ğŸ‡«ğŸ‡·',
                'å¾·å›½': 'ğŸ‡©ğŸ‡ª',
                'ç‘å…¸': 'ğŸ‡¸ğŸ‡ª',
                'æ³¢å…°': 'ğŸ‡µğŸ‡±',
                'èŠ¬å…°': 'ğŸ‡«ğŸ‡®',
                'æ¾³å¤§åˆ©äºš': 'ğŸ‡¦ğŸ‡º'
            };
            return flagMap[country] || 'ğŸ´';
        }

        // æ ¼å¼åŒ–å‘˜å·¥æ•°é‡æ˜¾ç¤º
        function formatEmployeeCount(count) {
            if (count >= 10000) return (count / 1000).toFixed(0) + 'k+';
            if (count >= 1000) return (count / 1000).toFixed(1) + 'k';
            return count.toString();
        }
    </script>
</body>
</html>
